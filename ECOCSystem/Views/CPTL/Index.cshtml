@using ECOCSystem.Model
@using ECOCSystem.Tools
@model CPTLModel
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    DataAnnotationsModelValidatorProvider.AddImplicitRequiredAttributeForValueTypes = false;
}
<style>
    .address-setting {
        font-size:15px;
    }

    .add-button {
        border-radius: 50%;
        width: 50px;
        height: 50px;
        font-size: 30px;
        display: flex;
        align-content: center;
        justify-content: center;
        align-items: center;
    }

    .addnew-button {
        display: flex;
        align-items: flex-end;
    }


    .cptl-title-header {
        display: flex;
        align-items: center;
    }

        .cptl-title-header label {
            margin: 0;
   
        }

        .cptl-title-header .tooltip {
            white-space: nowrap;
        }
    /*addnew button*/
    .uiverse {
        position: relative;
        background: #ffffff;
        color: #000;
        /* padding: 15px; */
        margin: 10px;
        /* border-radius: 10px; */
        width: 32px;
        height: 33px;
        font-size: 17px;
        display: flex;
        justify-content: center;
        align-items: center;
        /* flex-direction: column; */
        box-shadow: 0 10px 10px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        border-radius: 50%;
        transition: all 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        background-color: darkgreen;
        color: white;
        font-size: 17px;
        font-weight: lighter;
    }

    

.tooltip {
  position: absolute;
  top: 0;
  font-size: 14px;
  background: #ffffff;
  color: #ffffff;
  padding: 5px 8px;
  border-radius: 5px;
  box-shadow: 0 10px 10px rgba(0, 0, 0, 0.1);
  opacity: 0;
  pointer-events: none;
  transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.tooltip::before {
  position: absolute;
  content: "";
  height: 8px;
  width: 8px;
  background: #ffffff;
  bottom: -3px;
  left: 50%;
  transform: translate(-50%) rotate(45deg);
  transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.uiverse:hover .tooltip {
  top: -45px;
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
}

svg:hover span,
svg:hover .tooltip {
  text-shadow: 0px -1px 0px rgba(0, 0, 0, 0.1);
}

    .uiverse:hover,
    .uiverse:hover .tooltip,
    .uiverse:hover .tooltip::before {
        /* background: linear-gradient(320deg, rgb(3, 77, 146), rgb(0, 60, 255));*/
        color: #ffffff;
        background-color: darkgreen;
    }
    /*addnew button*/



    .toggle-group {
        font-family: 'Source Sans Pro';
        color: #117a8b;
    }


    .btn-edit-1 {
        /*    margin-top: 25px;*/
        background-color: white;
        color: darkgreen;
        border-radius: 10px;
        box-shadow: 0px 0px 0px 0px gray !important;
    }


    .btn-edit-1 span i {
        font-size:23px;
    }


    #select-client .form-group {
        margin:0;
    }
    .card {
        margin-bottom: 0;
        box-shadow: 0 0 3px rgba(0,0,0,.125), 0 1px 5px rgba(0,0,0,.2);
    }

    .icheck-success > input:first-child:checked + input[type=hidden] + label::before, .icheck-success > input:first-child:checked + label::before {
        background-color: darkgreen;
        border-color: darkgreen;
    }

    .row {

        margin: 0;
    }
    .info-display {
        border-top: none;
        border-right: none;
        border-left: none;
        border-bottom: 1px solid #ddd;
        width: 100%;
        box-shadow: none;
        padding: 5px 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        min-height: 30px;
        /* font-weight: bold; */
/*        justify-content: center;*/
        font-weight: 500;
        margin-bottom: 20px;
    }

    .info-label {
        font-size: smaller;
        letter-spacing: .5px;
        text-transform: uppercase;
    /*    display: flex;
        justify-content: center;*/
    }

    blockquote h1, blockquote h2, blockquote h3, blockquote h4, blockquote h5, blockquote h6 {
        font-weight: 100;

    }


</style>
<section class="content">
    <div class="card card-success card-outline">


        <div class="card-header" >
            <h3 class="card-title">CTPL Application</h3>
        </div>
        <div class="card-body">
            <div id="example2_wrapper" class="dataTables_wrapper dt-bootstrap4">
                <div class="row">
                    <div class="col-sm-12">
                        @using (Html.BeginForm("CPTL", "CPTL", null, FormMethod.Post, new { enctype = "multipart/form-data", id = "CPTL_Form" }))
                        {
                            @Html.AntiForgeryToken()
                            @Html.HiddenFor(o => o.CPTLID, new { Value = "CPTLID" })
                            @Html.HiddenFor(m => m.AddressID)
                            @Html.HiddenFor(m => m.VehicleID)
                            <section class="row pb-4 ">
                                <div class="col-12 col-sm-12 card">
                                    @*<h6 class="card-title card-header"><b>Client Address list</b></h6>*@
                                    <div class="cptl-title-header card-header">
                                        <label>Registration Type</label>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-group col-sm-11">
                                            <div class="input-group">
                                                @Html.DropDownListFor(m => m.SelectedRegistrationTypeID, new SelectList(Model.RegistrationTypes, "ID", "RegistrationTypeInfo"), "Select Registration Type", new { @class = "form-control select2 select2Ajax", select2Ajax_url = Url.Action("GetRegistrationTypes", "GetData") })
                                            </div>
                                            @Html.ValidationMessageFor(m => m.SelectedRegistrationTypeID, "", new { @class = "" })
                                        </div>
                                    </div>

                                </div>
                            </section>
                            <section class="row pb-4">
                                <div class="col-12 col-sm-12 card">
                                    @*<h6 class="card-title card-header"><b>Client Address list</b></h6>*@
                                    <div class="cptl-title-header card-header " style="display: flex; align-items: center;">
                                        <label>Select Client</label>
                                        <div class="uiverse ">
                                            <span class="tooltip">Add new client</span>
                                            <span type="button" id="addClient" class="newclient" data-toggle="modal" data-target="#modal-client">
                                                @*<i class="fa fa-plus btn-sm"></i>*@
                                                +
                                            </span>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div id="select-client" class="dataTables_wrapper dt-bootstrap4">
                                            <div class="row">
                                                <div class="col-sm-12" style="display:flex;align-items:center;">
                                                    <div class="form-group col-sm-11">
                                                        <div class="input-group">
                                                            @Html.DropDownListFor(m => m.ClientID, new SelectList(Model.Clients, "ClientID", "ClientInfo"), "Select Client", new { @class = "form-control select2 select2Ajax", select2Ajax_url = Url.Action("GetClients", "GetData") })
                                                        </div>
                                                        @Html.ValidationMessageFor(m => m.ClientID, "", new { @class = "" })
                                                    </div>
                                                    <div class="col-sm-1  uiverse btn-edit-1 add-button">
                                                        <span class="tooltip" style="white-space:nowrap;">Edit client</span>
                                                        <span type="button" id="editClient" data-toggle="modal" data-target="#modal-client">
                                                            <i class="fa fa-user-edit btn-sm"></i>

                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </section>
                            <section class="row pb-4">
                                <div class="col-12 col-sm-12 card">
                                    <div class="cptl-title-header card-header " style="display: flex; align-items: center;">
                                        <label>Address List</label>
                                        <div class="uiverse ">
                                            <span class="tooltip">Add new address</span>
                                            <span type="button" id="addAddress" class="newaddress" data-toggle="modal" data-target="#modal-client-address">
                                                +
                                            </span>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div id="example2_wrapper" class="dataTables_wrapper dt-bootstrap4">
                                            <div class="row">
                                                <div class="col-sm-12">
                                                    <table id="tbl_Address" class="table table-head-fixed table-hover dataTable dtr-inline table-hover dt-responsive nowrap" style="width:100%; min-width: 90em">
                                                        <thead>
                                                            <tr>
                                                                <th><center>Select</center></th>
                                                                <th>Address Type</th>
                                                                <th>House Bldg No</th>
                                                                <th>Street Subdivision</th>
                                                                <th>Barangay</th>
                                                                <th>Zip Code</th>
                                                                <th>City</th>
                                                                <th>Province</th>
                                                            </tr>
                                                        </thead>
                                                    </table>
                                                    @*<table id="example2" class="table table-head-fixed table-hover dataTable dtr-inline " style="cursor:pointer" aria-describedby="example2_info" t>
                                        <thead>
                                            <tr>
                                                <th class="sorting" tabindex="0" aria-controls="example2" rowspan="1" colspan="1" aria-label="Browser: activate to sort column ascending">Select</th>
                                                <th class="sorting" tabindex="0" aria-controls="example2" rowspan="1" colspan="1" aria-label="Browser: activate to sort column ascending">Street Name</th>
                                                <th class="sorting" tabindex="0" aria-controls="example2" rowspan="1" colspan="1" aria-label="Browser: activate to sort column ascending">Barangay</th>
                                                <th class="sorting" tabindex="0" aria-controls="example2" rowspan="1" colspan="1" aria-label="Browser: activate to sort column ascending">City</th>
                                                <th class="sorting" tabindex="0" aria-controls="example2" rowspan="1" colspan="1" aria-label="Browser: activate to sort column ascending">Address Type</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                    </table>*@
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                            <section class="row pb-4">
                                <div class="col-12 col-sm-12 card">
                                    <div class="cptl-title-header card-header " style="display: flex; align-items: center;">
                                        <label>Vehicle List</label>
                                        <div class="uiverse ">
                                            <span class="tooltip">Add new vehicle</span>
                                            <span type="button" id="addVehicle" class="newvehicle" data-toggle="modal" data-target="#modal-client-vehicle">
                                                +
                                            </span>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div id="example2_wrapper" class="dataTables_wrapper dt-bootstrap4">
                                            <div class="row">
                                                <div class="col-sm-12">
                                                    <table id="tbl_Vehicle" class="table table-head-fixed table-hover dataTable dtr-inline table-hover dt-responsive nowrap" style="width:100%; min-width: 90em">
                                                        <thead>
                                                            <tr>
                                                                <th><center>Select</center></th>
                                                                <th>Vehicle Type</th>
                                                                <th>Serial / Chassis</th>
                                                                <th>Plate No.</th>
                                                                <th>Year</th>
                                                                <th>Make</th>
                                                                <th>Body</th>
                                                                <th>Series</th>
                                                                <th><center>Action Edit</center></th>
                                                            </tr>
                                                        </thead>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                            <section class="row mt-4 pb-4 submit-btn">
                                <button data-toggle="modal" data-target="#modal-ApplicationSummary" id="submit_Summary" class="btn btn-success" type="button" style="height: 45px; ">Submit Application</button>
                            </section>


                            <div class="modal fade" id="modal-client" style="display: none;" aria-hidden="true">
                                <div class="modal-dialog modal-xl">

                                    @{
                                        Html.RenderPartial("_Client", Model.Client, new ViewDataDictionary() { TemplateInfo = new TemplateInfo() { HtmlFieldPrefix = "Client" } });
                                    }
                                </div>

                            </div>



                            <div class="modal fade" id="modal-client-address" style="display: none;" aria-hidden="true">
                                <div class="modal-dialog modal-xl">
                                    @{
                                        Html.RenderPartial("_Address", Model.ClientAddress, new ViewDataDictionary() { TemplateInfo = new TemplateInfo() { HtmlFieldPrefix = "ClientAddress" } });
                                    }
                                </div>

                            </div>

                            <div class="modal fade" id="modal-client-vehicle" style="display: none;" aria-hidden="true">
                                <div class="modal-dialog modal-xl">
                                    @{
                                        Html.RenderPartial("_Vehicle", Model.ClientVehicle, new ViewDataDictionary() { TemplateInfo = new TemplateInfo() { HtmlFieldPrefix = "ClientVehicle" } });
                                    }
                                </div>

                            </div>

                            <div class="modal fade" id="modal-ApplicationSummary" style="display: none;" aria-hidden="true">
                                <div class="modal-dialog modal-xl">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h4 class="modal-title">Application Summary</h4>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true"><i class="fa" fa></i>×</span>
                                            </button>
                                        </div>
                                        <div class="modal-body @*overlay*@" style="padding:2rem;">                  
                                             
                                            <div id="client" class="dataTables_wrapper dt-bootstrap4">
                                                <div class="row">
                                                    <div class="col-sm-12">




                                                        <blockquote>
                                                            <div class="row">
                                                                <div class="form-group col-lg-12 info-container">
                                                                    <h6 class="">Client</h6>
                                                                </div>

                                                            </div>
                                                            <div class="row">
                                                                <div class="form-group col-lg-12 info-container Type" data-attribute='@Convert.ToInt32(TitleTypeEnum.Corporate)' data-attribute2='@Convert.ToInt32(TitleTypeEnum.CorporateWithAssignee)'>
                                                                    <label class="info-label">Corporate Name</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_CorpName"></span>
                                                                </div>
                                                                <div class="form-group col-lg-4 info-container Type" data-attribute='@Convert.ToInt32(TitleTypeEnum.Individual)' data-attribute2='@Convert.ToInt32(TitleTypeEnum.CorporateWithAssignee)'>
                                                                    <label class="info-label">First Name</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_FirstName"></span>
                                                                </div>
                                                                <div class="form-group col-lg-4 info-container Type" data-attribute='@Convert.ToInt32(TitleTypeEnum.Individual)' data-attribute2='@Convert.ToInt32(TitleTypeEnum.CorporateWithAssignee)'>
                                                                    <label class="info-label">Last Name</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_LastName"></span>
                                                                </div>
                                                                <div class="form-group col-lg-4 info-container Type" data-attribute='@Convert.ToInt32(TitleTypeEnum.Individual)' data-attribute2='@Convert.ToInt32(TitleTypeEnum.CorporateWithAssignee)'>
                                                                    <label class="info-label">Middle Name</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_MiddleName"></span>
                                                                </div>
                                                            </div>
                                                        </blockquote>

                                                        <blockquote>
                                                            <div class="row">
                                                                <div class="form-group col-lg-12 info-container">
                                                                    <h6 class="">Address</h6>
                                                                </div>

                                                            </div>

                                                            <div class="row">
                                                                <div class="form-group col-lg-4 info-container">
                                                                    <label class="info-label">House Blg No.</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_HouseBldg"></span>
                                                                </div>
                                                                <div class="form-group col-lg-4 info-container">
                                                                    <label class="info-label">Street Name</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_Street"></span>
                                                                </div>
                                                                <div class="form-group col-lg-4 info-container">
                                                                    <label class="info-label">Barangay</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_Barangay"></span>
                                                                </div>
                                                                <div class="form-group col-lg-4 info-container">
                                                                    <label class="info-label">City</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_City"></span>
                                                                </div>
                                                                <div class="form-group col-lg-4 info-container">
                                                                    <label class="info-label">Province</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_Province"></span>
                                                                </div>
                                                            </div>
                                                        </blockquote>

                                                        <blockquote>
                                                            <div class="row">
                                                                <div class="form-group col-lg-12 info-container">
                                                                    <h6 class="">Vehicle</h6>
                                                                </div>

                                                            </div>

                                                            <div class="row">
                                                                <div class="form-group col-lg-4 info-container">
                                                                    <label class="info-label">Engine Number</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_Engine"></span>
                                                                </div>
                                                                <div class="form-group col-lg-4 info-container">
                                                                    <label class="info-label">Chassis Number</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_Chassis"></span>
                                                                </div>
                                                                <div class="form-group col-lg-4 info-container">
                                                                    <label class="info-label">MV FileNumber</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_MVFile"></span>
                                                                </div>
                                                                <div class="form-group col-lg-4 info-container">
                                                                    <label class="info-label">Plate Number</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_Plate"></span>
                                                                </div>
                                                                <div class="form-group col-lg-4 info-container">
                                                                    <label class="info-label">Year</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_Year"></span>
                                                                </div>
                                                                <div class="form-group col-lg-4 info-container">
                                                                    <label class="info-label">Make</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_Make"></span>
                                                                </div>
                                                                <div class="form-group col-lg-4 info-container">
                                                                    <label class="info-label">Series</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_Series"></span>
                                                                </div>
                                                                <div class="form-group col-lg-4 info-container">
                                                                    <label class="info-label">Body Type</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_Body"></span>
                                                                </div>
                                                                <div class="form-group col-lg-4 info-container">
                                                                    <label class="info-label">Color</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_Color"></span>
                                                                </div>
                                                                <div class="form-group col-lg-4 info-container">
                                                                    <label class="info-label">Vehicle Type</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_VehicleType"></span>
                                                                </div>
                                                                <div class="form-group col-lg-6 info-container">
                                                                    <label class="info-label">Classification</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_Classification"></span>
                                                                </div>
                                                            </div>
                                                        </blockquote>

                                                        <blockquote>

                                                            <div class="row">
                                                                <div class="form-group col-lg-4 info-container">
                                                                    <label class="info-label">Registration Type</label>
                                                                    <span class="input-group info-display" data-toggle="tooltip" id="Application_RegistrationType">Select Registration Type</span>
                                                                </div>

                                                            </div>
                                                        </blockquote>




                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <div id="" class="modal-footer justify-content-between submit-btn">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                            <button type="button" id="submit_Application" class="btn btn-success">Apply</button>
                                        </div>
                                    </div>

                                </div>

                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
  
   
</section>

<script>

    var addAntiForgeryToken = function (data) {
        data.__RequestVerificationToken = $("[name='__RequestVerificationToken']").val();
        return data;
    };

    function submitForm(submitType) {
        var form = jQuery("#CPTL_Form");
        if (form.valid()) {
            var formData = new FormData(form[0]);
            formData.append("submitType", submitType);
            $.ajax({
                url: '@Url.Action("CPTL", "CPTL")',
                type: "POST",
                dataType: "JSON",
                contentType: false,
                processData: false,
                async: true,
                data: addAntiForgeryToken(formData),
                beforeSend: function () {
                    toastr.clear();

                },
                success: function (response) {
                    switch (response.Status) {
                        case "Success":

                            if (response.ClientID > 0) {
                                getAddressList(response.ClientID)
                                getVehicleList(response.ClientID)
                            }
                            console.log(response.CurrentSubmit)
                            switch (response.CurrentSubmit) {
                                case "Client":
                                    $("#modal-client").modal('hide');
                                    clearClientForm(response.ClientID)
                                    break;
                                case "Address":
                                    $("#modal-client-address").modal('hide');
                                    clearAddressForm()
                                    break;
                                case "Vehicle":
                                    $("#modal-client-vehicle").modal('hide');
                                    getVehicleList(response.ClientID)
                                    clearVehicleForm();

                                    break;
                                case "CTPL":
                                    showCOCFile(response.FileName);
                                    break;
                                default:
                                    break;
                            }

                            toastr.success(response.Message);
                            break;
                        case "Warning":
                            toastr.warning(response.Message);
                            break;
                        case "Error":
                            toastr.error(response.Message);
                            break;
                        case "Info":
                            toastr.info(response.Message);
                            break;
                        default:
                            toastr.error(response.Message);
                            break;
                    }

                },
                error: function (xhr, status, error) {
                    toastr.error('An error has occured while processing, Please contact Databridge Support.');
                },
                complete: function () {
                  /*  $(".modal").modal('hide');*/
                /*    $('.modal-backdrop').remove();*/
                    $('#loadingScreen').hide();
                },
            });
        }
/*        $(".tab-content").height("auto");*/
    }
    $(document).ready(function () {


        $("#btm_csr_btn_container").html('' +
            '<button type="button" id="verify_csr" class="btn btn-block btn-success" style="width: 250px;"> Submit </button>');

        $('#isRenewal').bootstrapToggle({
            toggle: "toggle",
            on: "Renewal",
            off: "New Registration",
            onstyle: "outline-success",
            offstyle: "outline-success  ",
            width: "100%",
            height: "100%",
        });

        getAddressList(0)
        getVehicleList(0)



        $('#ClientID').on('change', function () {
            $('#VehicleID').val(0)
            $('#AddressID').val(0)



            let ID = $(this).val();
            getAddressList(ID)
            getVehicleList(ID)
            getClientInfo(ID)



        });
        $('#submit_Summary').on('click', function () {
            getcheckedVehicle();

            getcheckedAddress();
        });


        $('#submit_Application').on('click', function () {
            submitForm("CTPLAPPLICATION");
        });

        $('#SelectedRegistrationTypeID').on('change', function () {

            //for Application Summary
            $("#Application_RegistrationType").text($("#SelectedRegistrationTypeID option:selected").text());

        });



    });


    function showCOCFile(FileName)
    {
        $('#loadingScreen').show();

        $('#modal-ApplicationSummary .modal-body').empty();

        $('#modal-ApplicationSummary .modal-body').append(`<iframe id="report_viewer" frameborder="0"
                    scrolling="no" seamless="seamless" marginheight="0" marginwidth="0" role="document" style="width: 100%; margin: 0%; height: 720px;" aria-label="PDF document" title="PDF document"></iframe>`)

        $('#report_viewer').attr('src', '@Url.Content("~/Reports/VRTempFiles/")' + FileName);


        $('#modal-ApplicationSummary .modal-title').text('COC File')

        $('#modal-ApplicationSummary .modal-footer').empty();

        $('#loadingScreen').hide();

        $('#modal-ApplicationSummary').on('hide.bs.modal', function (e) {
            window.location.reload(true)

        });
    }
    function getAddressList(ClientID) {

        clearAddressForm()
        let cntRow = 0;
        vehicle_table = $("#tbl_Address").DataTable({
            "processing": true, // for show progress bar
            "serverSide": false, // for process server side
            "filter": true, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "scrollX": true,
            "scrollY": true,
            "destroy": true,

            "order": [],
            "dom":
                "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" +
                "<'row'<'col-sm-12'tr>>" +
                "<'row'<'col-sm-12 col-md-5'p><'col-sm-12 col-md-7'i>>",
            "ajax": {
                "url": '@Url.Action("GetClientAddressList", "CPTL")',
                "type": "POST",
                "datatype": "json",
                "data": function (o) {
                    o.ClientID = ClientID;
                },
                "beforeSend": function () {

                    cntRow = 0;
                },
                "complete": function (row, data, dataIndex) {
                   /* getcheckedAddress()*/
                }
            },
            "createdRow": function (row, data, dataIndex) {

            },
            "columns": [
                {
                    "className": "AddressID", "data": null, "name": "AddressID",
                    render: function (data, type, row) {
                        return `<center>
                                  <div class="icheck-primary d-inline">
                                    <input class="chk" `+ data.isChecked +` name="checkAddress" type="checkbox" AddressID="`+ data.AddressID +`" id="address`+ data.AddressID +`">
                                        <label for="address`+ data.AddressID+`">
                                    </label>
                                 </div>
                              </center>`
                    }, "autoWidth": true
                },
                { "className": "AddressType", "data": "AddressType", "name": "AddressType", "autoWidth": true },
                { "className": "HouseBldgNo", "data": "HouseBldgNo", "name": "HouseBldgNo", "autoWidth": true },
                { "className": "StreetName", "data": "StreetName", "name": "StreetName", "autoWidth": true },
                { "className": "Barangay", "data": "Barangay", "name": "Barangay", "autoWidth": true },
                { "className": "ZipCode", "data": "ZipCode", "name": "ZipCode", "autoWidth": true },
                { "className": "City", "data": "City", "name": "City", "autoWidth": true },
                { "className": "Province", "data": "Province", "name": "Province", "autoWidth": true },

            ]
        });
        $('#tbl_Address_paginate').parent('div').parent('div').css('flex-direction', 'row-reverse').css('margin', '12px');

        $(document).on("change", "input[name='checkAddress']", function () {
            $('input.chk').not(this).prop('checked', false);

            let AddressID = $(this).attr('AddressID');
            $('#AddressID').val(AddressID);
            getAddressInfo(AddressID)

        });
    };


    function getVehicleList(ClientID) {
        clearVehicleForm()
        let cntRow = 0;
        vehicle_table = $("#tbl_Vehicle").DataTable({
            "processing": true, // for show progress bar
            "serverSide": false, // for process server side
            "filter": true, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "scrollX": true,
            "scrollY": true,
            "destroy": true,

            "order": [],
            "dom":
                "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" +
                "<'row'<'col-sm-12'tr>>" +
                "<'row'<'col-sm-12 col-md-5'p><'col-sm-12 col-md-7'i>>",
            "ajax": {
                "url": '@Url.Action("GetClientVehicleList", "CPTL")',
                "type": "POST",
                "datatype": "json",
                "data": function (o) {
                    o.ClientID = ClientID;
                },
                "beforeSend": function () {

                    cntRow = 0;
                },
                "complete": function (row, data, dataIndex) {
                 /*   getcheckedVehicle()*/
                }
            },
            "createdRow": function (row, data, dataIndex) {

            },
            "columns": [
                {
                    "className": "VehicleID", "data": null, "name": "VehicleID",
                    render: function (data, type, row) {
                        return `<center>
                                  <div class="icheck-primary d-inline">
                                    <input class="chk2" `+data.isChecked+` name="checkVehicle"  type="checkbox" VehicleID="`+ data.VehicleID+`" id="vehicle`+ data.VehicleID +`">
                                        <label for="vehicle`+ data.VehicleID+`">
                                    </label>
                                 </div>
                              </center>`
                    }, "autoWidth": true
                },
                { "className": "VehicleType", "data": "VehicleType", "name": "VehicleType", "autoWidth": true },
                { "className": "Chassis", "data": "Chassis", "name": "Chassis", "autoWidth": true },
                { "className": "PlateNo", "data": "PlateNo", "name": "PlateNo", "autoWidth": true },
                { "className": "Year", "data": "Year", "name": "Year", "autoWidth": true },
                { "className": "VehicleMake", "data": "VehicleMake", "name": "VehicleMake", "autoWidth": true },
                { "className": "VehicleBody", "data": "VehicleBody", "name": "VehicleBody", "autoWidth": true },
                { "className": "VehicleSeries", "data": "VehicleSeries", "name": "VehicleSeries", "autoWidth": true },
                {
                    "className": "edit", "data": null, "name": "edit",
                    render: function (data, type, row) {
                        return `<center>
                                            <div class="">
                                                <span type="button" data-toggle="modal" onclick="EditVehicle(`+ data.VehicleID + `)" data-target="#modal-client-vehicle" class="vehicleEdit" VehicleID="` + data.VehicleID + `">
                                                    <i class="fa fa-pencil-alt fa-lg text-primary" style="padding: 0px"></i>
                                                </span>
                                            </div>
                                        </center>`
                    }, "autoWidth": true
                },

            ]
        });

        //will optimize this
        $(document).on('click', "span.vehicleEdit", function () {
            $('#vehicleOptions').empty();
            $('#vehicleOptions').append(`<button  class="btn btn-outline-success" data-dismiss="modal">Cancel</button>
                      <button type="buttin" id="submit_editVehicle" value="EDITVEHICLE" class="btn btn-success">Update</button>`);

            $('#submit_editVehicle').on('click', function (e) {
                e.preventDefault();
                submitForm("EDITVEHICLE");
            });
        });


        $('#tbl_Vehicle_paginate').parent('div').parent('div').css('flex-direction', 'row-reverse').css('margin', '12px');

        $(document).on("change", "input[name='checkVehicle']", function () {
            $('input.chk2').not(this).prop('checked', false);

            let VehicleID = $(this).attr('VehicleID');
            $('#VehicleID').val(VehicleID);
            getVehicleInfo(VehicleID);
        });

    };

    function EditVehicle(VehicleID) {

       $('#loadingScreen').show();
        $.ajax({
            url: '@Url.Action("GetVehicleInfo", "GetData")',
            type: "GET",
            cache: false,
            dataType: "JSON",
            beforeSend: function () {
                $('#loadingScreen').show();
            },
/*            async: false,*/
            data: { "VehicleID": VehicleID },
            success: function (response) {

                $('#ClientVehicle_VehicleID').val(response.VehiceID);
                $('#ClientVehicle_EngineNumber').val(response.Chassis);
                $('#ClientVehicle_ChassisNumber').val(response.Chassis);
                $('#ClientVehicle_MVFileNumber').val(response.MVFile);
                $('#ClientVehicle_PlateNumber').val(response.Plate);
                $('#ClientVehicle_Year').val(response.Year);

                var selectedMake = $("<option selected='selected'></option>").val(response.MakeID).text(response.Make)
                $("#ClientVehicle_SelectedMakeID").append(selectedMake).trigger('change');

                var selectedBody = $("<option selected='selected'></option>").val(response.BodyTypeID).text(response.BodyType)
                $("#ClientVehicle_SelectedBodyTypeID").append(selectedBody).trigger('change');

                var SelectedColor = $("<option selected='selected'></option>").val(response.ColorID).text(response.Color)
                $("#ClientVehicle_SelectedColorID").append(SelectedColor).trigger('change');

                var SelectedSeries = $("<option selected='selected'></option>").val(response.VariantID).text(response.Series)
                $("#ClientVehicle_SelectedVariantID").append(SelectedSeries).trigger('change');

                var SelectedVehicleType = $("<option selected='selected'></option>").val(response.VTypeID).text(response.VType)
                $("#ClientVehicle_SelectedVehicleTypeID").append(SelectedVehicleType).trigger('change');

                var SelectedClassification = $("<option selected='selected'></option>").val(response.ClassificationID).text(response.Classification)
                $("#ClientVehicle_SelectedClassificationID").append(SelectedClassification).trigger('change');


            },
            error: function (xhr, status, error) {
                toastr.error('An error has occured while processing, Please contact Databridge Support.');
            },
            complete: function () {
                $('#loadingScreen').hide();
            },
        });

    }

    function getcheckedVehicle()
    {

        let VehiceID = $('input[name="checkVehicle"]:checked').attr('VehicleID')

        if (VehiceID != undefined) {
            $('#VehicleID').val(VehiceID);
            getVehicleInfo(VehiceID)
        }
        else
        {
            VehiceID = 0
            $('#VehicleID').val(VehiceID);
            clearVehicleForm()
        }
          


    }
    function getcheckedAddress() {

        let AddressID = $('input[name="checkAddress"]:checked').attr('AddressID')

        if (AddressID != undefined) {
            $('#AddressID').val(AddressID);
            getAddressInfo(AddressID)
        }
        else
        {
            AddressID = 0
            $('#AddressID').val(AddressID);
            clearAddressForm()
        }

        //$("input:checkbox[name=checkVehicle]:checked").each(function () {
        //    let VehicleID = $(this).attr('VehicleID');
        //    $('#VehicleID').val(VehicleID);
        //    getVehicleInfo(VehicleID);
        //});
    }

    function clearVehicleForm()
    {
        $('#ClientVehicle_VehicleID').val(0);
        $('#ClientVehicle_EngineNumber').val('');
        $('#ClientVehicle_ChassisNumber').val('');
        $('#ClientVehicle_MVFileNumber').val('');
        $('#ClientVehicle_PlateNumber').val('');
        $('#ClientVehicle_Year').val('');


        $("#Application_Engine").text('')
        $("#Application_Chassis").text('')
        $("#Application_MVFile").text('')
        $("#Application_Plate").text('')
        $("#Application_Year").text('')
        $("#Application_Body").text('')
        $("#Application_Color").text('')
        $("#Application_Series").text('')
        $("#Application_Make").text('')
        $("#Application_VehicleType").text('')
        $("#Application_Classification").text('')

        var selectedMake = $("<option selected='selected'></option>").val(0).text('Select Vehicle Make')
        $("#ClientVehicle_SelectedMakeID").append(selectedMake).trigger('change');

        var selectedBody = $("<option selected='selected'></option>").val(0).text('Select Body Type')
        $("#ClientVehicle_SelectedBodyTypeID").append(selectedBody).trigger('change');

        var SelectedColor = $("<option selected='selected'></option>").val(0).text('Select Color')
        $("#ClientVehicle_SelectedColorID").append(SelectedColor).trigger('change');

        var SelectedSeries = $("<option selected='selected'></option>").val(0).text('Select Series')
        $("#ClientVehicle_SelectedSeriesID").append(SelectedSeries).trigger('change');

        var SelectedVehicleType = $("<option selected='selected'></option>").val(0).text('Select Vehicle Type')
        $("#ClientVehicle_SelectedVehicleTypeID").append(SelectedVehicleType).trigger('change');

        var SelectedClassification = $("<option selected='selected'></option>").val(0).text('Select Classification')
        $("#ClientVehicle_SelectedClassificationID").append(SelectedClassification).trigger('change');


    }
    function clearAddressForm() {


        $("#Application_HouseBldg").text('')
        $("#Application_Street").text('')
        $("#Application_Barangay").text('')
        $("#Application_City").text('')
        $("#Application_Province").text('')


        $('#ClientAddress_ClientAddressID').val(0);
        $('#ClientAddress_HouseBldgNo').val('');
        $('#ClientAddress_StreetSubdivision').val('');
        $('#ClientAddress_Barangay').val('');
        $('#ClientAddress_ZipCode').val('');
        $('#ClientAddress_EmailAddress').val('');
        $('#ClientAddress_MobileNo').val('');
        $('#ClientAddress_TelephoneNo').val('');

    }

    function clearClientForm(ClientID) {

        let Individual = 1;
        let Corporate = 2;
        let CorporateWithAssignee = 3;
        let ClientName = '';

          $.ajax({
                url: '@Url.Action("GetTitleTypeID","GetData")',
                type: "GET",
                cache: false,
                dataType: "JSON",
     /*           async: false,*/
                data: { "TitleID": $('#Client_TitleID').val() },
                beforeSend: function () {

                    $('#loadingScreen').show();
                },
              success: function (response) {

                  switch (response.ID) {
                        case Individual:
                            ClientName = $('#Client_FirstName').val() + " " + $('#Client_MiddleName').val() + " " + $('#Client_LastName').val();
                            break;
                        case Corporate:
                            ClientName = $('#Client_CorpName').val();
                            break;
                        case CorporateWithAssignee:
                            ClientName = $('#Client_FirstName').val() + " " + $('#Client_MiddleName').val() + " " + $('#Client_LastName').val() + "  - " + $('#Client_CorpName').val();
                            break;
                        default:
                        // code block
                  }

                    //set value of select2 dropdown for cliend
                    var selectedClient = $("<option selected='selected'></option>").val(ClientID).text(ClientName)
                    $("#ClientID").append(selectedClient).trigger('change');

                },
                complete: function () {
                    $('#loadingScreen').hide();
                    $('#Client_ClientID').val(0);
                    $('#Client_CorpName').val('');
                    $('#Client_FirstName').val('');
                    $('#Client_LastName').val('');
                    $('#Client_MiddleName').val('');
                    $('#Client_EmailAddress').val('');
                    $('#Client_BusinessPhone').val('');
                    $('#Client_MobileNo').val('');
                },
          });


    }

    let getAddressInfo = (AddressID) => {

        $('#loadingScreen').show();
        $.ajax({
            url: '@Url.Action("GetAddressInfo", "GetData")',
            type: "GET",
            cache: false,
            dataType: "JSON",
            beforeSend: function () {
                $('#loadingScreen').show();
            },
    /*        async: false,*/
            data: { "AddressID": AddressID },
            success: function (response) {

                $("#Application_HouseBldg").text(response.HouseBldgNo)
                $("#Application_Street").text(response.StreetName)
                $("#Application_Barangay").text(response.Barangay)
                $("#Application_City").text(response.City)
                $("#Application_Province").text(response.Province)
            },
            error: function (xhr, status, error) {
                toastr.error('An error has occured while processing, Please contact Databridge Support.');
            },
            complete: function () {
                $('#loadingScreen').hide();
            },
        });

    };
    let getClientInfo = (ClientID) => {

        $('#loadingScreen').show();
        $.ajax({
            url: '@Url.Action("GetClientInfo", "GetData")',
            type: "GET",
            cache: false,
            dataType: "JSON",
            beforeSend: function () {
                $('#loadingScreen').show();
            },
/*            async: false,*/
            data: { "ClientID": ClientID },
            success: function (response) {

                switchTitleType(response.TitleTypeID)

                $("#Application_CorpName").text(response.corpName)
                $("#Application_FirstName").text(response.firstName)
                $("#Application_LastName").text(response.lastName)
                $("#Application_MiddleName").text(response.middleName)

            },
            error: function (xhr, status, error) {
                toastr.error('An error has occured while processing, Please contact Databridge Support.');
            },
            complete: function () {
                $('#loadingScreen').hide();
            },
        });

    };
     let getVehicleInfo = (VehicleID) => {

        $('#loadingScreen').show();
        $.ajax({
            url: '@Url.Action("GetVehicleInfo", "GetData")',
            type: "GET",
            cache: false,
            dataType: "JSON",
            beforeSend: function () {
                $('#loadingScreen').show();
            },
/*            async: false,*/
            data: { "VehicleID": VehicleID },
            success: function (response) {

                $("#Application_Engine").text(response.Engine)
                $("#Application_Chassis").text(response.Chassis)
                $("#Application_MVFile").text(response.MVFile)
                $("#Application_Plate").text(response.Plate)
                $("#Application_Year").text(response.Year)
                $("#Application_Body").text(response.BodyType)
                $("#Application_Color").text(response.Color)
                $("#Application_Series").text(response.Series)
                $("#Application_Make").text(response.Make)
                $("#Application_VehicleType").text(response.VType)
                $("#Application_Classification").text(response.Classification)


            },
            error: function (xhr, status, error) {
                toastr.error('An error has occured while processing, Please contact Databridge Support.');
            },
            complete: function () {
                $('#loadingScreen').hide();
            },
        });

    };

    function switchTitleType(selection) {

            if (selection == 3) {
                $('div.Type').filter('[data-attribute2="' + selection + '"]').show();
                $('div.Type').not('[data-attribute2="' + selection + '"]').hide();

            }
            else
            {
                $('div.Type').filter('[data-attribute="' + selection + '"]').show();
                $('div.Type').not('[data-attribute="' + selection + '"]').hide();
            }
    }
</script>
